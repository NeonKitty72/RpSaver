<!--*************************************************************
	Suzanne Kersten
	06/04/2017
	RP-Saver: Saves all your rp's in an easy-to-read format!
	
	TOADD:Actual good formatting? It works 4 now tho
	Idea: Make structure of first specieal character, make a 
		struct that tells where it is and what fun to do?
		Then push that and use the beginning of special char
		to put it all into the Done Output
*************************************************************-->
<!DOCTYPE html>
<html lang="en">

<head>
	<title>RP Saver</title>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="stylesheet.css">
	
	<!--***********************************************************************************************************************************
		JAVASCRIPT CODE
	************************************************************************************************************************************-->
	<script>
		var css;	//used in saving the file 
	
		function makeItNoice(){			
			var allText = document.getElementById("rp").value;		//Text that is in the user input textArea
			var toOutput = "";										//Wat to add to the current output-chat box
			

			//GOOD code for making things into chatboxes
			document.getElementById("shitToWrite").innerHTML = "";
			var left = 1;
			for (var i = 0; i < allText.length; i++){
				//pick up text until we hit crlf
				if (allText.charAt(i) != "\r" && allText.charAt(i) != "\n")
					toOutput += allText.charAt(i)
				
				//output text, reset vars for next output
				if (allText.charAt(i) == "\n"){					
					//set up text to display
					var text = 	document.createElement("p");
					if (left) 	text.setAttribute("class", "leftRP");
					else 		text.setAttribute("class", "rightRP");
					
					var t = document.createTextNode(toOutput);
					text.appendChild(t);					
					document.getElementById("shitToWrite").appendChild(text);
					
					
					toOutput = "";
					left = (left + 1) % 2;
				}
				
			}
			//one last output to grab the last response
			var text = 	document.createElement("p");
			if (left) 	text.setAttribute("class", "leftRP");
			else 		text.setAttribute("class", "rightRP");
			var t = document.createTextNode(toOutput);
			text.appendChild(t);					
			document.getElementById("shitToWrite").appendChild(text);
			
			activateSaveButton();
	
		}	
		
		
		/*
			Make Whatever is stored in shitToWrite available to be saved. Get the css from the 
			webpage stored in NeonKitty's GitHub.io page. If that file can't be accessed in 3 seconds, 
			use a baked in version of the css.
		*/
		function activateSaveButton(){
			var headText
			getFileFromServer("https://neonkitty72.github.io/stylesheet.css", function(text){if (text != null) finishActivateSaveButton(text); });
			setTimeout(function() {checkForValidCSSFileOpen()}, 3000);
		}
		
		/*
			If the css file wasn't grabbed from the server, use the baked in css and still activate the save button.
		*/
		function checkForValidCSSFileOpen(){
			if (document.getElementById("saveBtn").innerHTML == "")
			{
				alert("Could not access most recent CSS file. Using the baked-in CSS. (You can most likely ignore this and continue on with no problems.)");
				var headText = '#shitToWrite{width: 800px;margin: auto;}.leftRP {max-width: 75%;min-width: 40%;background-color: #E9E8F1;font-size: 14px;font-color: #25201C;padding: 10px;margin: 0px;margin-bottom: 4px;border-radius: 10px;float: left;}.rightRP {max-width: 75%;min-width: 40%;background-color: #DCF2D4;font-size: 14px;font-color: #25201C;font-family: Verdana, sans-serif;padding: 10px;margin: 0px;margin-bottom: 4px;border-radius: 10px;float: right;}'		
				finishActivateSaveButton(headText);
			}
		}
		
		/*
			Set up the html of the file to save and prepare the save button, actually activating it.
			Set up the html of the file to save and prepare the save button, actually activating it.
		*/
		function finishActivateSaveButton(headText){
			
			//Set up the basic html of the file to save
			headText = '<html lang="en"><head><title>RP Saver</title><meta charset="UTF-8"><style>' + headText;
			headText = headText + '</style></head><body><div id="shitToWrite">';
			var text = document.getElementById("shitToWrite").innerHTML;
			//set up the save button to actually save the file 
			var saveBtn = document.getElementById("saveBtn");
			saveBtn.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(headText + text + "</div></body></html>"));
			saveBtn.setAttribute('download', "RP.html");
			saveBtn.innerHTML = "Save this as a web page file";
		
		}
		
		/*
			Gets a file from a server using a basic GET protocol from the specified url. 
			Returns the file contents through a passed in function.
		*/
		function getFileFromServer(url, doneCallBack) {
			var xhr;
			
			xhr = new XMLHttpRequest();
			xhr.onreadystatechange = handleStateChange;
			xhr.open("GET", url, true);
			xhr.send();
			
			function handleStateChange() {
				if (xhr.readyState == 4) {
					doneCallBack(xhr.status == 200 ? xhr.responseText : null);
				}
			}
		}
	
	</script>	
</head>

	<!--***********************************************************************************************************************************
		HTML CODE
	************************************************************************************************************************************-->
<body>
	<!-- Where user inputs text -->
	<textarea rows="10" cols="50" name="rp" id="rp">[TheFiendHerself]: lol oh no look I'm a shitty mockup! *eats u* nomph nomph cronch cronch on the kitty who is pretty and skitty and this is a long paragraph that I'm just trying to make really long so I can have multiple liiiiines Tails is cute and I need oone more line there we go
[Other Person]: lol oh no look I'm a shitty mockup! *eats u* nomph
[TheFiendHerself]: lol oh no look I'm a shitty mockup! *eats u* nomph</textarea> 
	
	<!-- Input buttons. Save button is nothing to start because we can't save what user didn't 'compile' -->
	<br />
	<input type="submit" value="Make this look nice!" onclick="makeItNoice()" style="margin-bottom: 10px">
	<a id="saveBtn"></a>
	<br />
	<div id="shitToWrite">
		<!-- Where the rp text will go -->
	</div>
</body>
</html>